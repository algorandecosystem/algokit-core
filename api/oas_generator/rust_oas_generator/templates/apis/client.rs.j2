/*
 * {{ spec.info.title }}
 *
 * {{ spec.info.description or "API client generated from OpenAPI specification" }}
 *
 * The version of the OpenAPI document: {{ spec.info.version }}
 {% if spec.info.contact and spec.info.contact.email %} * Contact: {{ spec.info.contact.email }}
 {% endif %} * Generated by: Rust OpenAPI Generator
 */

use super::{configuration, Error};
{% if operations %}
{% set used_types = [] %}
{% for operation in operations %}
    {% set operation_types = get_operation_used_types(operation) %}
    {% for type_name in operation_types %}
        {% if type_name not in used_types %}
            {% set _ = used_types.append(type_name) %}
        {% endif %}
    {% endfor %}
    {# Also collect request body types #}
    {% if has_request_body(operation) %}
        {% set request_body_type = get_request_body_type(operation) %}
        {% if request_body_type and should_import_request_body_type(request_body_type) and request_body_type not in used_types %}
            {% set _ = used_types.append(request_body_type) %}
        {% endif %}
    {% endif %}
{% endfor %}
{% if used_types %}
use crate::models::{
{% for used_type in used_types %}
    {{ used_type }},
{% endfor %}
};
{% endif %}
{% endif %}

/// The main Algod API client.
///
/// This client provides convenient access to all Algod API endpoints.
/// It wraps the lower-level endpoint functions with a more ergonomic interface.
#[derive(Debug, Clone)]
pub struct AlgodClient {
    configuration: configuration::Configuration,
}

impl AlgodClient {
    /// Create a new AlgodClient with custom configuration.
    pub fn new(configuration: configuration::Configuration) -> Self {
        Self { configuration }
    }

    /// Create a new AlgodClient with a custom base URL and optional API token.
    pub fn with_url(base_url: &str, api_token: Option<&str>) -> Self {
        let mut config = configuration::Configuration::default();
        config.base_path = base_url.trim_end_matches('/').to_string();

        if let Some(token) = api_token {
            config.api_key = Some(configuration::ApiKey {
                prefix: None,
                key: token.to_string(),
            });
        }

        Self::new(config)
    }

    /// Create a new AlgodClient for Algorand TestNet.
    pub fn testnet() -> Self {
        Self::with_url("https://testnet-api.4160.nodely.dev", None)
    }

    /// Create a new AlgodClient for Algorand MainNet.
    pub fn mainnet() -> Self {
        Self::with_url("https://mainnet-api.4160.nodely.dev", None)
    }

    /// Create a new AlgodClient for a local sandbox environment.
    pub fn sandbox() -> Self {
        Self::with_url("http://localhost:4001", Some("aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"))
    }

    /// Get a reference to the underlying configuration.
    pub fn configuration(&self) -> &configuration::Configuration {
        &self.configuration
    }

    /// Get a mutable reference to the underlying configuration.
    pub fn configuration_mut(&mut self) -> &mut configuration::Configuration {
        &mut self.configuration
    }

{% for operation in operations %}
    {% if operation.summary %}
    /// {{ operation.summary }}
    {% elif operation.description %}
    /// {{ operation.description | replace('\n', '\n    /// ') }}
    {% endif %}
    {% if operation.deprecated %}
    #[deprecated]
    {% endif %}
    pub async fn {{ operation.rust_function_name }}(
        &self,
    {% if has_request_body(operation) %}
        {% set request_body_name = get_request_body_name(operation) %}
        {% set request_body_type = get_request_body_type(operation) %}
        {% if is_request_body_required(operation) %}{{ request_body_name }}: {{ request_body_type }},
        {% else %}{{ request_body_name }}: Option<{{ request_body_type }}>,
        {% endif %}
    {% endif %}
    {% for param in operation.parameters %}
        {% if param.required %}{{ param.rust_name }}: {% if param.rust_type == "String" %}&str{% else %}{{ param.rust_type }}{% endif %},
        {% else %}{{ param.rust_name }}: Option<{% if param.rust_type == "String" %}&str{% else %}{{ param.rust_type }}{% endif %}>,
        {% endif %}
    {% endfor %}
    ) -> Result<{% if get_success_response_type(operation) %}{{ get_success_response_type(operation) }}{% else %}(){% endif %}, Error<super::{{ operation.rust_function_name }}::{{ operation.rust_error_enum }}>> {
        super::{{ operation.rust_function_name }}::{{ operation.rust_function_name }}(
            &self.configuration,
        {% if has_request_body(operation) %}
            {{ get_request_body_name(operation) }},
        {% endif %}
        {% for param in operation.parameters %}
            {{ param.rust_name }},
        {% endfor %}
        ).await
    }

{% endfor %}
}

impl Default for AlgodClient {
    fn default() -> Self {
        Self::new(configuration::Configuration::default())
    }
}
